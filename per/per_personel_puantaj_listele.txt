let
    Kaynak = let
PostContents = "{""login"":{""username"":"""&Kullanici&""",""password"": """&Parola&""",""disconnect_same_user"": ""True"",""lang"": ""tr"",""params"":{""apikey"":"""&Api&"""}}}",
Source = Web.Contents("https://"&Firma&".ws.dia.com.tr/api/v3/sis/json",[Content=Text.ToBinary(PostContents)]),
api_key = Text.FromBinary(Source),
msg_index = Text.PositionOf(api_key,"msg"),
msg_text = Text.Range(api_key,msg_index),
msg_text2 = Text.Range(msg_text,7),
msg_index2= Text.PositionOf(msg_text2,",""c"),
session_id = Text.Range(api_key,9,32),

PostContents2 = "{""per_personel_puantaj_listele"" : {""session_id"":""" & session_id & """, 
""firma_kodu"": "&FirmaKodu&", 
""donem_kodu"": "&FirmaDonem&",
""params"": {""selectedcolumns"": [
""_key"",
""_level1"",
""_level2"",
""adi"",
""asgarikumgelirvergisitutari"",
""asgarikumgvmatrahi"",
""asgariucretdvistisnasi"",
""asgariucretgvistisnasi"",
""aylikbrutkazanc"",
""aylikmesaikazanci"",
""ayliknetkazanc"",
""damgavergisimatrahi"",
""damgavergisitutari"",
""dovizkuru"",
""duzenlemeayno"",
""duzenlemetarihi"",
""dvmatrahmuafiyeti"",
""gelirvergisimatrahi"",
""gelirvergisitutari"",
""gssisci"",
""gssisci_muafiyettutari"",
""gssisveren"",
""gvmatrahmuafiyeti"",
""haftasonugun"",
""haftasonusaat"",
""hesaplanandamgavergisi"",
""hesaplanangelirvergisi"",
""hesaplanangvmatrah"",
""isebaslamatarihi"",
""issizlikiscipayitutari"",
""issizlikisverenpayitutari"",
""istenayrilmatarihi"",
""kalanprojetutari"",
""kisavadeliskisveren"",
""kumgelirvergisitutari"",
""maas"",
""maasyerel"",
""netmesaikazanci"",
""normalmesaigun"",
""normalmesaikazanci"",
""normalmesaisaat"",
""odemeturu"",
""odenecekdamgavergisi"",
""odenecekgelirvergisi"",
""persbelgeturu"",
""personeladisoyadi"",
""personelsicilno"",
""personelsube"",
""persozelkodaciklama"",
""sgk_6111kanunindirimi"",
""sigortamatrahi"",
""soyadi"",
""toplambordrogun"",
""toplamiscisskprimtutari"",
""toplamissizlikprimtutari"",
""toplamisvereniscisskprimtutari"",
""toplamisverensskprimtutari"",
""toplamnetkazanc"",
""toplamsigortagun"",
""toplamsigortasaat"",
""uygulanacakasgariucretgvist"",
""uygulanacakgvmatrahmuafiyeti"",
""uzunvadeliskisci"",
""uzunvadeliskisveren""
    ]}}}",
Source2 = Web.Contents("https://"&Firma&".ws.dia.com.tr/api/v3/per/json",[Content=Text.ToBinary(PostContents2)])
in 
Source2,
    ImportedJSON = Json.Document(Kaynak,1254),
    result = ImportedJSON[result],
    #"Tabloya Dönüştürüldü" = Table.FromList(result, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
    #"Genişletilen Column1" = Table.ExpandRecordColumn(#"Tabloya Dönüştürüldü", "Column1", {"odenecekdamgavergisi", "istenayrilmatarihi", "maasyerel", "toplamsigortasaat", "toplamnetkazanc", "hesaplanangelirvergisi", "asgariucretgvistisnasi", "toplamissizlikprimtutari", "damgavergisimatrahi", "uzunvadeliskisveren", "sgk_6111kanunindirimi", "kalanprojetutari", "gssisci_muafiyettutari", "persbelgeturu", "kumgelirvergisitutari", "asgarikumgelirvergisitutari", "personeladisoyadi", "gelirvergisimatrahi", "hesaplanangvmatrah", "haftasonugun", "asgariucretdvistisnasi", "persozelkodaciklama", "adi", "_level2", "gssisci", "_level1", "odenecekgelirvergisi", "uygulanacakasgariucretgvist", "toplamiscisskprimtutari", "ayliknetkazanc", "toplamsigortagun", "duzenlemeayno", "maas", "aylikbrutkazanc", "issizlikisverenpayitutari", "personelsicilno", "gelirvergisitutari", "duzenlemetarihi", "toplambordrogun", "gvmatrahmuafiyeti", "gssisveren", "uzunvadeliskisci", "toplamisvereniscisskprimtutari", "aylikmesaikazanci", "isebaslamatarihi", "dovizkuru", "uygulanacakgvmatrahmuafiyeti", "personelsube", "normalmesaisaat", "odemeturu", "normalmesaikazanci", "hesaplanandamgavergisi", "_key", "haftasonusaat", "soyadi", "issizlikiscipayitutari", "dvmatrahmuafiyeti", "netmesaikazanci", "sigortamatrahi", "kisavadeliskisveren", "toplamisverensskprimtutari", "damgavergisitutari", "normalmesaigun", "asgarikumgvmatrahi"}, {"odenecekdamgavergisi", "istenayrilmatarihi", "maasyerel", "toplamsigortasaat", "toplamnetkazanc", "hesaplanangelirvergisi", "asgariucretgvistisnasi", "toplamissizlikprimtutari", "damgavergisimatrahi", "uzunvadeliskisveren", "sgk_6111kanunindirimi", "kalanprojetutari", "gssisci_muafiyettutari", "persbelgeturu", "kumgelirvergisitutari", "asgarikumgelirvergisitutari", "personeladisoyadi", "gelirvergisimatrahi", "hesaplanangvmatrah", "haftasonugun", "asgariucretdvistisnasi", "persozelkodaciklama", "adi", "_level2", "gssisci", "_level1", "odenecekgelirvergisi", "uygulanacakasgariucretgvist", "toplamiscisskprimtutari", "ayliknetkazanc", "toplamsigortagun", "duzenlemeayno", "maas", "aylikbrutkazanc", "issizlikisverenpayitutari", "personelsicilno", "gelirvergisitutari", "duzenlemetarihi", "toplambordrogun", "gvmatrahmuafiyeti", "gssisveren", "uzunvadeliskisci", "toplamisvereniscisskprimtutari", "aylikmesaikazanci", "isebaslamatarihi", "dovizkuru", "uygulanacakgvmatrahmuafiyeti", "personelsube", "normalmesaisaat", "odemeturu", "normalmesaikazanci", "hesaplanandamgavergisi", "_key", "haftasonusaat", "soyadi", "issizlikiscipayitutari", "dvmatrahmuafiyeti", "netmesaikazanci", "sigortamatrahi", "kisavadeliskisveren", "toplamisverensskprimtutari", "damgavergisitutari", "normalmesaigun", "asgarikumgvmatrahi"}),
    #"Değiştirilen Tür" = Table.TransformColumnTypes(#"Genişletilen Column1",{{"istenayrilmatarihi", type datetime}}),
    #"Değiştirilen Değer" = Table.ReplaceValue(#"Değiştirilen Tür",".",",",Replacer.ReplaceText,{"odenecekdamgavergisi", "maasyerel", "toplamsigortasaat", "toplamnetkazanc", "hesaplanangelirvergisi", "asgariucretgvistisnasi", "toplamissizlikprimtutari", "damgavergisimatrahi", "uzunvadeliskisveren", "sgk_6111kanunindirimi", "kalanprojetutari", "gssisci_muafiyettutari", "kumgelirvergisitutari", "asgarikumgelirvergisitutari", "gelirvergisimatrahi", "hesaplanangvmatrah", "haftasonugun", "asgariucretdvistisnasi", "gssisci", "odenecekgelirvergisi", "uygulanacakasgariucretgvist", "toplamiscisskprimtutari", "ayliknetkazanc", "toplamsigortagun", "maas", "aylikbrutkazanc", "issizlikisverenpayitutari", "gelirvergisitutari", "toplambordrogun", "gvmatrahmuafiyeti", "gssisveren", "uzunvadeliskisci", "toplamisvereniscisskprimtutari", "aylikmesaikazanci", "dovizkuru", "uygulanacakgvmatrahmuafiyeti", "normalmesaisaat", "normalmesaikazanci", "hesaplanandamgavergisi", "haftasonusaat", "issizlikiscipayitutari", "dvmatrahmuafiyeti", "netmesaikazanci", "sigortamatrahi", "kisavadeliskisveren", "toplamisverensskprimtutari", "damgavergisitutari", "normalmesaigun", "asgarikumgvmatrahi"}),
    #"Değiştirilen Tür1" = Table.TransformColumnTypes(#"Değiştirilen Değer",{{"odenecekdamgavergisi", type number}, {"maasyerel", type number}, {"toplamsigortasaat", type number}, {"toplamnetkazanc", type number}, {"hesaplanangelirvergisi", type number}, {"asgariucretgvistisnasi", type number}, {"toplamissizlikprimtutari", type number}, {"damgavergisimatrahi", type number}, {"uzunvadeliskisveren", type number}, {"sgk_6111kanunindirimi", type number}, {"kalanprojetutari", type number}, {"gssisci_muafiyettutari", type number}, {"kumgelirvergisitutari", type number}, {"asgarikumgelirvergisitutari", type number}, {"gelirvergisimatrahi", type number}, {"hesaplanangvmatrah", type number}, {"haftasonugun", type number}, {"asgariucretdvistisnasi", type number}, {"gssisci", type number}, {"odenecekgelirvergisi", type number}, {"uygulanacakasgariucretgvist", type number}, {"toplamiscisskprimtutari", type number}, {"ayliknetkazanc", type number}, {"toplamsigortagun", type number}, {"maas", type number}, {"aylikbrutkazanc", type number}, {"issizlikisverenpayitutari", type number}, {"gelirvergisitutari", type number}, {"toplambordrogun", type number}, {"gvmatrahmuafiyeti", type number}, {"gssisveren", type number}, {"uzunvadeliskisci", type number}, {"toplamisvereniscisskprimtutari", type number}, {"aylikmesaikazanci", type number}, {"dovizkuru", type number}, {"uygulanacakgvmatrahmuafiyeti", type number}, {"normalmesaisaat", type number}, {"normalmesaikazanci", type number}, {"hesaplanandamgavergisi", type number}, {"haftasonusaat", type number}, {"issizlikiscipayitutari", type number}, {"dvmatrahmuafiyeti", type number}, {"netmesaikazanci", type number}, {"sigortamatrahi", type number}, {"kisavadeliskisveren", type number}, {"toplamisverensskprimtutari", type number}, {"damgavergisitutari", type number}, {"normalmesaigun", type number}, {"asgarikumgvmatrahi", type number}}),
    #"Özel Eklendi" = Table.AddColumn(#"Değiştirilen Tür1", "ToplamMaliyet", each [aylikbrutkazanc]+[sgk_6111kanunindirimi]+[toplamisverensskprimtutari]+[issizlikisverenpayitutari])
in
    #"Özel Eklendi"